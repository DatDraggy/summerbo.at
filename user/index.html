<?php
require_once('../backend/config.php');
require_once('../backend/funcs.php');
session_start();
if(empty($_SESSION['userId'])){
  session_commit();
  header('Location: ../login');
  die();
}
$userId = $_SESSION['userId'];
session_commit();
$dbConnection = buildDatabaseConnection($config);

////////////////////////
// Check Reg Validity //
if (!checkRegValid($userId)) {
//If invalid, kill that bih
  if (isset($_COOKIE[session_name()])) {
    setcookie(session_name(), '', time() - 3600, '/');
  }
  session_destroy();
  header('Location: ../login.html');
  die();
}
// Check Reg Validity //
////////////////////////

$userStatus = $status[getRegDetails($userId, 'status')['status']];

$payments = getPaymentDetails($userId, 'date, amount');
$paymentsHtml = '';
foreach ($payments as $payment) {
  $amount = $payment['amount'];
  $date = date('Y-m-d', $payment['date']);

  $paymentsHtml .= '<span class="date">{$date}</span> <span class="amount">{$amount}â‚¬</span>';
}

?>


<?php echo $userStatus; ?>

<?php echo $paymentsHtml; ?>