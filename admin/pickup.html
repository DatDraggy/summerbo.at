<?php
require_once(__DIR__ . '/../backend/funcs.php');
require_once(__DIR__ . '/../backend/config.php');
require_once(__DIR__ . '/../backend/includesAdmin.php');
header('Cache-Control: max-age=0');
session_start();
if (!empty($_SESSION['userId'])) {
  $requesterUserId = $_SESSION['userId'];
  session_commit();
  $dbConnection = buildDatabaseConnection($config);
  $rank = 0;
  if (checkRegValid($requesterUserId)) {
    $rank = getUserRank($requesterUserId);
    if($rank < 3){
      die('Insufficient Permissions');
    }
  }
} else {
  /*if (isset($_COOKIE[session_name()])) {
    setcookie(session_name(), '', time() - 3600, '/');
  }
  session_destroy();*/
  $status = 'You are not logged in.';
  $_SESSION['status'] = $status;
  $_SESSION['location'] = $_SERVER['REQUEST_URI'];
  session_commit();
  header('Location: ../login');
  die($status);
}
?>
<!DOCTYPE html>
<html prefix="og: http://ogp.me/ns#" lang="en" dir="ltr">
<head>
  <title>Summerbo.at Admin: Badge Pickup</title>
  <?=$head?>
</head>
<body class="hasNav">
<div id="app">
  <?=$nav?>
  <section id="contentPage">
    <!-- ========== Info text ========== -->

    <section class="ribbon" style="background-color: var(--colorPink)">
      <div class="wrapper">
        <div class="row">
          <div style="color:white" class="content wsLarge">
            <h1 id="legal">Check-in</h1>
            <p class="textBig">This page is only available for the crew of Summerboat. Please login to use all abilities.</p>
          </div>
        </div>
      </div>
    </section>

    <section>

      <div class="row">
        <div class="content">
          <h2 id="adminsearch" class="headline">Search</h2>
          <p>Do not search for date of birth, favorite color or species.</p>
        </div>
		<div class="content">
          <h2 id="adminresults" class="headline">Search results</h2>
          <p>Please only select the person that needs to be checked in. Once checked in, it's not possible to check out anymore. Aka, Hotel California effect.</p>
        </div>
	  </div>
	  <div class="row">
        <div class="content">
		 <form class="formWrapper" id="adminsearch" method="post">
		 <div class="inputWrapper">
              <label for="searchadminfield"><span>Summerbo.at Check-in</span></label>
              <input name="regnumber" id="regnumber" class="input" placeholder="Name, Nickname, REG ID, EF ID" autocomplete="username" required/>
         </div>
		 <div class="formRow">
              <button class="button buttonPrimary"
                      data-callback="onSubmit">Search
              </button>
            </div>
		 </form>
	    </div>
	   </div>

    </section>
  </section>

  <?=$footer?>
</body>
</html>